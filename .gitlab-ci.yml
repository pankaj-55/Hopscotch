image: maven:3.9.4-eclipse-temurin-17

stages:
  - test

variables:
  DISPLAY: ":99"
  MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository"

cache:
  paths:
    - .m2/repository

before_script:
  - apt-get update
  - apt-get install -y wget gnupg2 software-properties-common curl unzip xvfb
  # Add Microsoft Edge repository
  - wget -q https://packages.microsoft.com/keys/microsoft.asc -O- | apt-key add -
  - add-apt-repository "deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main"
  - apt-get update
  - apt-get install -y microsoft-edge-stable
  - microsoft-edge-stable --version
  # Start virtual display
  - Xvfb :99 -ac &

test:
  stage: test
  script:
    - echo "Running tests on Microsoft Edge headless via WebDriverManager"
    - mvn clean test -DbrowserName=edge -DuseWebdriverManager=true -DrunHeadless=true
  artifacts:
    when: always
    paths:
      - target/cucumber-reports/
      - target/allure-results/
      - target/site/allure-maven-plugin/
    expire_in: 1 week


