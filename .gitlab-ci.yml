image: maven:3.9.4-eclipse-temurin-17

stages:
  - test

cache:
  paths:
    - .m2/repository

before_script:
  - apt-get update
  - apt-get install -y wget gnupg2 ca-certificates
  - wget -q -O - https://dl.mozilla.org/firefox/releases/112.0/linux-x86_64/en-US/firefox-112.0.tar.bz2 | tar xjf - -C /opt/
  - ln -sf /opt/firefox/firefox /usr/bin/firefox
  - apt-get install -y xvfb
  - Xvfb :99 -ac &
  - export DISPLAY=:99
  - echo "Preparing environment..."
  - firefox --version
  - mvn -version

test_job:
  stage: test
  script:
    - echo "Running tests..."
    - mvn -B clean test
  artifacts:
    when: always
    paths:
      - target/cucumber-reports/
      - target/allure-results/
      - target/site/allure-maven-plugin/
